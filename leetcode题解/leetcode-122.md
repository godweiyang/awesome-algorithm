---
title: 每日算法系列【LeetCode 122】买卖股票的最佳时机 II
top: false
cover: false
toc: true
mathjax: true
date: 2020-02-25 21:07:29
password:
summary:
tags:
- leetcode
- 算法
categories:
- 编程算法
---

> 关注公众号【算法码上来】，每日算法干货马上就来！

![](/medias/contact.jpg)

## 题目描述
给定一个数组，它的第 i 个元素是一支给定股票第 i 天的价格。

设计一个算法来计算你所能获取的最大利润。你可以尽可能地完成更多的交易（多次买卖一支股票）。

注意：你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。

**示例1**
```text
输入：
[7,1,5,3,6,4]
输出：
7
解释：
在第 2 天（股票价格 = 1）的时候买入，在第 3 天（股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。
随后，在第 4 天（股票价格 = 3）的时候买入，在第 5 天（股票价格 = 6）的时候卖出, 这笔交易所能获得利润 = 6-3 = 3 。
```

**示例2**
```text
输入：
[1,2,3,4,5]
输出：
4
解释：
在第 1 天（股票价格 = 1）的时候买入，在第 5 天 （股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。
注意你不能在第 1 天和第 2 天接连购买股票，之后再将它们卖出。
因为这样属于同时参与了多笔交易，你必须在再次购买前出售掉之前的股票。
```

## 题解
这是 **【买卖股票的最佳时机】** 系列题目的第二题。

这题买卖次数变成了不限，但是仍然要求在买之前必须先卖掉股票。那么观察股票的价格曲线，最优策略就是在每一段单调上升的子区间里，区间开始时购买，区间结束时卖出。这样就能保证所有的上升区间全部充分利用到了。正确性证明也不难，假设买卖过程中包含了一段下降的子区间，那么去掉它，在下降区间开头卖出，在下降区间末尾买入，得到的利润一定大于包含这段下降区间。

在具体实现时，我们可以计算相邻两个股票价格差，如果价格是上升的，那就在利润上加上它，否则就不用管。

最终的答案就是：
$$
\sum_{0 < i < n}{\max{\left\{price[i] - price[i-1], 0\right\}}}
$$

时间复杂度是 $O(n)$ 。

## 代码
### python
```python
class Solution:
    def maxProfit(self, prices: List[int]) -> int:
        n, res = len(prices), 0
        for i in range(1, n):
            res += max(prices[i]-prices[i-1], 0)
        return res
```